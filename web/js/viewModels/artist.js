define(["ojs/ojcore","knockout","jquery","../spotify","knockout-postbox","ojs/ojchart","ojs/ojrouter"],function(e,t,o,s){function n(){var o,n,u;u=this,n=function(e){return u.albums().every(function(t){return e.name!==t.name||e.popularity>t.items[0]})},o=function(e){s.fetchAlbumDetails(e).then(function(e){n(e)&&u.albums.push({id:e.id,name:e.name,items:[e.popularity]})})},u.artist=t.observable().subscribeTo("selectedArtist",!0),u.albums=t.observableArray([]),s.fetchAlbumsByArtist(u.artist().id).then(function(e){e.items.forEach(function(e){o(e.id)})}),u.selectedAlbums=t.observableArray([]).publishOn("selectedAlbums"),u.selectedAlbums.subscribe(function(){e.Router.rootInstance.go("album")})}return n});